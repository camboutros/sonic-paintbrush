<html>
<head>
<script src="p5.min.js"></script>
<script src="p5.sound.min.js"></script>
</head>
<body>
<script>

'use strict';
var img; 

let playing = false;
let osc;
let osc2;
let osc3;
let freq = 240;
let freq2 = freq * (3/2); // fifth above root note
let freq3 = freq * (5/4); // major third above root note
let max = 0;
let maxGain = 0;

var radius = 100;

function preload(){
    img = loadImage("power.png");  // Load the image
}

function setup(){
    createCanvas(displayWidth,displayHeight);

    osc = new p5.Oscillator();
    osc.setType('sine');
    osc.freq(freq);
    osc.amp(0.2);
    osc.start();
    playing = true;


    osc2 = new p5.Oscillator();
    osc2.setType('sine');
    osc2.amp(0.4); // a little lower in volume for balance
    osc2.freq(freq2);


    osc3 = new p5.Oscillator();
    osc3.setType('sine');
    osc3.amp(0.3); // a little lower in volume for balance
    osc3.freq(freq2);

}
function draw(){
    if (deviceOrientation == undefined) {
        background(255);
    }
    else if (deviceOrientation == LANDSCAPE){
        background(255,rotationX,0);
    }
    else if (deviceOrientation == PORTRAIT){
        background(0,255,rotationX);
    }

   // osc.freq(freq + pRotationX);

    let rotX = pRotationX - rotationX;
    let accel = abs(accelerationX) + abs(accelerationY) + abs(accelerationZ);
    let gain = Math.cbrt(accel)/8;
    osc.amp(gain);
    osc2.amp(gain/1.25);
    osc3.amp(gain/1.55);

    if(accel > max) {
        max = accel;
    }
    if(gain > maxGain) {
        maxGain = gain;
    }

    /*if(abs(rotX) > .5){
        if(rotX > 0){
            osc.setType('sawtooth');
        }else{
            osc.setType('sine');
        }
    }*/

    osc2.freq( (freq + pRotationX) * (3/2));
    osc3.freq( (freq + pRotationX) * (5/4)); 
    // Buttons
    fill (255, 0, 0);
    rect(0, 0, 100, 60); 
    image(img, 25, 6, 50, 50);
    let txtSize = 24;
    let txtStart = 100;
    textSize(txtSize);
    text("Accel: "+accel,0,100);
    text("Gain: "+gain,0,130)
    text("Max Accel: "+max, 0,160);
    text("Max Gain: "+maxGain, 0, 190);
     

}

function mousePressed(){
//     if (playing){
//         osc.stop();
//         playing = false;
//     }else{
//         osc.start();
//         playing = true;
//     }
}

function mouseClicked(){
    image(img, 25, 6, 50, 50);
    if (mouseX < 100 && mouseY < 60) {
        if (playing == false){
            osc.start();
            playing = true;
        } else {
            osc.stop();
            playing = false;
        }
    }
}

function touchStarted(){
    fill(0, 255, 255);
    ellipse(mouseX, mouseY, radius, radius);
    if (playing == true) {
        osc2.start();
        if (touches.length > 1) {
            osc3.start();
        }
    }
}

function touchEnded(){
    background(255,255,255);
    radius = 100;
    osc2.stop();
    osc3.stop();
}


</script>
</body>
</html>
